"use strict";class DayBless{constructor(e){this.global=e,this.states={countdownTime:5},this.sets={today:moment(),manjushriDays:{"初一":"受福-吉","初二":"官事","初三":"歡喜-吉","初四":"富貴-吉","初五":"面黑","初六":"神通-吉","初七":"康寧-吉","初八":"壽長-吉","初九":"聞法-吉","初十":"記別-吉","十一":"眼明-吉","十二":"困苦","十三":"少白","十四":"神定-吉","十五":"大吉-吉","十六":"向益-吉","十七":"多病","十八":"犯盜","十九":"悟道-吉","二十":"禍崇","二一":"患難","二二":"受俱-吉","二三":"多聞-吉","二四":"證果-吉","二五":"鬥諍","二六":"祥瑞-吉","二七":"瘡癬","二八":"受寃","二九":"長慧-吉","三十":"如意-吉"},chtDay:{Sun:"日",Mon:"一",Tue:"二",Wed:"三",Thu:"四",Fri:"五",Sat:"六"}}}calBbuild(){const e=this.sets.today.format("YYYY-MM-DD"),t="1TMZHX9LRmb6ROdXsysHY5hKFubWuM2klz51xLOGYSLE",s=0,a="calRender",o=`${"https://spreadsheets.google.com/tq?"}tqx=responseHandler:${a}&tq=${encodeURI(`select * where A = date '${e}'`)}&key=${t}&gid=${s}`;$.getScript(o),this.global[a]=(e=>{const t=this.sets.today,s=this.sets.chtDay[t.format("ddd")],a=e.table.rows[0].c,o=a[1].v,i=this.sets.manjushriDays[o.slice(o.length-2)];if($("#js-date").text(t.format("YYYY.MM.DD")+"("+s+")").fitText(1.05),$(".bless-title").fitText(.9),$(".cal-lunar__val").text(o),i.indexOf("-")>-1?$(".cal-manjushri__val").addClass("good").text(i.slice(0,2)):$(".cal-manjushri__val").text(i),null!==a[2]&&null!==a[2].v){const e=a[2].v.split(",");for(const t of e)$(".cal-spDay").append(`<div class="item">${t}</div>`)}if(null!==a[3]&&null!==a[3].v){const e=a[3].v.split(",");for(const t of e)$(".buddha-info .list").append(`<li><div class="item">${t}</div></li>`)}$("#js-preToday").text(this.sets.today.format("MM.DD"))})}gameAnswer(){const e=this.bless.length,t=this.bless[function(e,t=0){return Math.floor(Math.random()*(+e-+t))+ +t}(e)];$("#js-fortune").text(t.fortune),$("#js-answerDestSub").html(t.sp);const s={height:360,width:640,videoId:t.videoId};t.videoStart?s.startSeconds=t.videoStart:s.startSeconds=0;try{let e;e=new YT.Player("ytplayer",{videoId:s.videoId,startSeconds:s.startSeconds,playerVars:{start:s.startSeconds},events:{onReady:t=>{e.playVideo()}}})}catch(e){const t=`<iframe width="${s.width}" height="${s.height}" src="https://www.youtube.com/embed/${s.videoId}?start=${s.startSeconds}" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`;$(".answer-mv").append(t)}$("#subscribe").on("click",e=>{e.preventDefault();const s=$(e.currentTarget).data("href");$(e.currentTarget).prop("disabled",!0),this.saveToGdrive("subscribe",s,t.fortune)})}gameBody(e="entry"){switch(e){case"entry":$("#countdown").show(),$("#signing").removeClass("active"),$("#signStart").prop("disabled",!0),$("#js-blessing").addClass("active").fadeIn("fast");break;default:$("#countdown").hide(),$("#js-blessing").removeClass("active").fadeOut("slow"),$.fancybox.defaults.animationEffect="zoom-in-out",$.fancybox.open({src:"#js-answer",type:"inline",opts:{afterClose:(e,t)=>{$("#signStart").prop("disabled",!1),$("#signing").addClass("active")}}})}}startGame(){$("#signStart").on("click",e=>{e.preventDefault();const t=this.gameBody;t(),this.saveToGdrive("play");let s=1e3*this.states.countdownTime;!function e(){s<=0?t("back"):setTimeout(e,1e3),s-=1e3}()})}saveToGdrive(e,t,s){const a=(()=>{try{return this.guestIpObj.responseJSON.ip}catch(e){return""}})(),[o,i]=(()=>FRUBIL?[FRUBIL.client.name,FRUBIL.client.os]:["error","can not import FRUBIL"])(),r={type:"post",url:"https://script.google.com/macros/s/AKfycbxgfyVf9xXWTEVz7ck_lLcIqhlE7MTb159wYbKq_mhPCqhOwh2j/exec",data:{method:"write",time:this.guestTime,ip:a,browser:o,status:e,note:`${i}`}};"subscribe"===e&&(r.complete=(()=>{(e=>{window.location.href=e})(t)}),r.data.note=`${s}: ${i}`),$.ajax(r)}btnBind(){$(".btn--bless").on("click",()=>{$("body").addClass("day"),this.dayView()}),$("#subscribe").on("click",e=>{e.preventDefault();$(e.currentTarget).data("href");$(e.currentTarget).prop("disabled",!0)})}dayView(){const e="1TMZHX9LRmb6ROdXsysHY5hKFubWuM2klz51xLOGYSLE",t=307467837,s="blessRender",a=`${"https://spreadsheets.google.com/tq?"}tqx=responseHandler:${s}&tq=${encodeURI(`select * where A = ${function(e,t=1){return Math.floor(Math.random()*(+e-+t))+ +t}(10)}`)}&key=${e}&gid=${t}`;$.getScript(a),this.global[s]=(e=>{const t=e.table.rows[0].c,[s,a]=[t[1].v||90,t[2].v.split(",")||"今天的您，看來事事得心應手、順心如意、所求皆能如意滿願：),想辦法讓自己的心很穩定，不要心隨萬境波,趁有福報的時候，應該搶時間修福，要時時提醒自己打從我們從娘胎出世，無常就在逼著我們。,無常來了，順境一彈指剎那之間就會變成大逆境！<br>我們要修擺脫三惡道的業力習氣，不要很茫茫然的過日子，要積極的成辦自他二利。"],o={videoId:t[4]||"4ozNk1G4Ao8",width:"100%",height:300,startSeconds:t[5]||0};let i="";const r=`inset ${.4*s}px -10px #eccc68`;$("#js-blessMoon").css({"box-shadow":r}),$("#js-blessNum").text(s);for(const e of a)i+=`<p>${e}</p>`;$("#js-blessContent").append(i),anime.timeline({easing:"easeOutElastic(1, .8)"}).add({targets:"#js-blessMoon",keyframes:[{opacity:1,duration:750,translateY:-10},{translateY:0,duration:250}],delay:1e3}).add({targets:"#js-blessNum",keyframes:[{fontSize:"3em",duration:750},{fontSize:"1em",duration:250}]},1e3).add({targets:".bless__main p",top:0,duration:250,opacity:1,delay:anime.stagger(300),easing:"linear"});try{let e;e=new YT.Player("ytplayer",{videoId:o.videoId,playerVars:{start:o.startSeconds},events:{onReady:t=>{console.log(t),e.playVideo()}}})}catch(e){const t=`<iframe width="${o.width}" height="${o.height}" src="https://www.youtube.com/embed/${o.videoId}?start=${o.startSeconds}" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`;$("#ytplayer").append(t)}})}devMode(){$(".btn--bless").trigger("click")}main(){this.calBbuild(),this.btnBind()}}window.addEventListener("load",e=>{$("#js-loader").fadeOut("slow"),$("#wrap").css("visibility","visible"),new DayBless(window).main()});