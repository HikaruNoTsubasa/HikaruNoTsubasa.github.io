"use strict";class DayBless{constructor(e){this.global=e,this.states={countdownTime:5},this.sets={today:moment(),manjushriDays:{"åˆä¸€":"å—ç¦-å‰","åˆäºŒ":"å®˜äº‹","åˆä¸‰":"æ­¡å–œ-å‰","åˆå››":"å¯Œè²´-å‰","åˆäº”":"é¢é»‘","åˆå…­":"ç¥é€š-å‰","åˆä¸ƒ":"åº·å¯§-å‰","åˆå…«":"å£½é•·-å‰","åˆä¹":"èæ³•-å‰","åˆå":"è¨˜åˆ¥-å‰","åä¸€":"çœ¼æ˜-å‰","åäºŒ":"å›°è‹¦","åä¸‰":"å°‘ç™½","åå››":"ç¥å®š-å‰","åäº”":"å¤§å‰-å‰","åå…­":"å‘ç›Š-å‰","åä¸ƒ":"å¤šç—…","åå…«":"çŠ¯ç›œ","åä¹":"æ‚Ÿé“-å‰","äºŒå":"ç¦å´‡","äºŒä¸€":"æ‚£é›£","äºŒäºŒ":"å—ä¿±-å‰","äºŒä¸‰":"å¤šè-å‰","äºŒå››":"è­‰æœ-å‰","äºŒäº”":"é¬¥è«","äºŒå…­":"ç¥¥ç‘-å‰","äºŒä¸ƒ":"ç˜¡ç™¬","äºŒå…«":"å—å¯ƒ","äºŒä¹":"é•·æ…§-å‰","ä¸‰å":"å¦‚æ„-å‰"},chtDay:{Sun:"æ—¥",Mon:"ä¸€",Tue:"äºŒ",Wed:"ä¸‰",Thu:"å››",Fri:"äº”",Sat:"å…­"}},this.guestIpObj=$.getJSON("https://api.ipify.org?format=jsonp&callback=?"),this.cached=(()=>{if(localStorage.getItem("blessCal")){const e=JSON.parse(localStorage.getItem("blessCal"));return e.date===this.sets.today.format("YYYY-MM-DD")?e:{date:this.sets.today.format("YYYY-MM-DD")}}return{date:this.sets.today.format("YYYY-MM-DD")}})()}calBbuild(){const e=this.sets.today.format("YYYY-MM-DD"),t="1TMZHX9LRmb6ROdXsysHY5hKFubWuM2klz51xLOGYSLE",s=0,a="calRender",o=`${"https://spreadsheets.google.com/tq?"}tqx=responseHandler:${a}&tq=${encodeURI(`select * where A = date '${e}'`)}&key=${t}&gid=${s}`;$.getScript(o),this.global[a]=(e=>{const t=this.sets.today,s=this.sets.chtDay[t.format("ddd")],a=e.table.rows[0].c,o=a[1].v,i=this.sets.manjushriDays[o.slice(o.length-2)];if($("#js-date").text(t.format("YYYY.MM.DD")+"("+s+")").fitText(1.05),$(".bless-title").fitText(.9),$(".cal-lunar__val").text(o),i.indexOf("-")>-1?$(".cal-manjushri__val").addClass("good").text(i.slice(0,2)):$(".cal-manjushri__val").text(i),null!==a[2]&&null!==a[2].v){const e=a[2].v.split(",");for(const t of e)$(".cal-spDay").append(`<div class="item">${t}</div>`)}if(null!==a[3]&&null!==a[3].v){const e=a[3].v.split(",");for(const t of e)$(".buddha-info .list").append(`<li><div class="item">${t}</div></li>`)}$("#js-preToday").text(this.sets.today.format("MM.DD"))})}saveToGdrive(e,t,s){const a=(()=>{try{return this.guestIpObj.responseJSON.ip}catch(e){return""}})(),[o,i]=(()=>FRUBIL?[FRUBIL.client.name,FRUBIL.client.os]:["error","can not import FRUBIL"])(),d={type:"post",url:"https://script.google.com/macros/s/AKfycbx20Lla6yjYC26h7QDNDGv5tTZ-Mft1EhAIWVqYotrtXxjm85Pk/exec",data:{method:"write",time:this.sets.today.format("YYYY-MM-DD hh:mm:ss"),ip:a,browser:o,status:e,note:`${i}`}};"subscribe"===e&&(d.complete=(()=>{(e=>{window.location.href=e})(t)}),d.data.note=`${s}: ${i}`),$.ajax(d)}btnBind(){$(".btn--bless").on("click",()=>{$("body").addClass("day"),this.cached.percent?(alert("æ‚¨å·²ç¶“çœ‹éä»Šæ—¥é‹å‹¢å›‰ğŸ˜Š"),this.dayViewCached()):this.dayView()}),$("#subscribe").on("click",e=>{e.preventDefault();const t=$(e.currentTarget).data("href");$(e.currentTarget).prop("disabled",!0),this.saveToGdrive("subscribe",t,$("#js-blessNum").text())})}dayViewCached(){const[e,t]=[this.cached.percent,this.cached.blessContent],s={videoId:this.cached.videoId,width:"100%",height:300,startSeconds:this.cached.startSeconds};let a,o="";const i=`inset ${.4*e}px -10px #eccc68`;$("#js-blessMoon").css({"box-shadow":i}),$("#js-blessNum").text(e);for(const e of t)o+=`<p>${e}</p>`;$("#js-blessContent").append(o),anime.timeline({easing:"easeOutElastic(1, .8)",begin:()=>{try{a=new YT.Player("ytplayer",{videoId:s.videoId,playerVars:{start:s.startSeconds}})}catch(e){const t=`<iframe width="${s.width}" height="${s.height}" src="https://www.youtube.com/embed/${s.videoId}?start=${s.startSeconds}" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`;$("#ytplayer").append(t)}},complete:()=>{anime.timeline({complete:()=>{a.playVideo()}}).add({targets:".wrap--day .page-footbox",height:"20.5vh",begin:()=>{$(".page-footbox").addClass("active")}}).add({targets:".wrap--day .ytbox, .wrap--day .ripple",opacity:1})}}).add({targets:"#js-blessMoon",keyframes:[{opacity:1,duration:750,translateY:-10},{translateY:0,duration:250}],delay:1e3}).add({targets:"#js-blessNum",keyframes:[{fontSize:"3em",duration:750},{fontSize:"1em",duration:250}]},1e3).add({targets:".bless__main p",top:0,duration:250,opacity:1,delay:anime.stagger(300),easing:"linear"})}dayView(){const e="1TMZHX9LRmb6ROdXsysHY5hKFubWuM2klz51xLOGYSLE",t=307467837,s="blessRender",a=`${"https://spreadsheets.google.com/tq?"}tqx=responseHandler:${s}&tq=${encodeURI(`select * where A = ${function(e,t=1){return Math.floor(Math.random()*(+e-+t))+ +t}(10)}`)}&key=${e}&gid=${t}`;$.getScript(a),this.global[s]=(e=>{const t=e.table.rows[0].c,[s,a]=[t[1].v||90,t[2].v.split(",")||"ä»Šå¤©çš„æ‚¨ï¼Œçœ‹ä¾†äº‹äº‹å¾—å¿ƒæ‡‰æ‰‹ã€é †å¿ƒå¦‚æ„ã€æ‰€æ±‚çš†èƒ½å¦‚æ„æ»¿é¡˜ï¼š),æƒ³è¾¦æ³•è®“è‡ªå·±çš„å¿ƒå¾ˆç©©å®šï¼Œä¸è¦å¿ƒéš¨è¬å¢ƒæ³¢,è¶æœ‰ç¦å ±çš„æ™‚å€™ï¼Œæ‡‰è©²æ¶æ™‚é–“ä¿®ç¦ï¼Œè¦æ™‚æ™‚æé†’è‡ªå·±æ‰“å¾æˆ‘å€‘å¾å¨˜èƒå‡ºä¸–ï¼Œç„¡å¸¸å°±åœ¨é€¼è‘—æˆ‘å€‘ã€‚,ç„¡å¸¸ä¾†äº†ï¼Œé †å¢ƒä¸€å½ˆæŒ‡å‰é‚£ä¹‹é–“å°±æœƒè®Šæˆå¤§é€†å¢ƒï¼<br>æˆ‘å€‘è¦ä¿®æ“ºè„«ä¸‰æƒ¡é“çš„æ¥­åŠ›ç¿’æ°£ï¼Œä¸è¦å¾ˆèŒ«èŒ«ç„¶çš„éæ—¥å­ï¼Œè¦ç©æ¥µçš„æˆè¾¦è‡ªä»–äºŒåˆ©ã€‚"];this.cached.percent=s,this.cached.blessContent=a;const o={videoId:t[4].v||"4ozNk1G4Ao8",width:"100%",height:300,startSeconds:t[5].v||0};let i;this.cached.videoId=o.videoId,this.cached.startSeconds=o.startSeconds,localStorage.setItem("blessCal",JSON.stringify(this.cached));let d="";const r=`inset ${.4*s}px -10px #eccc68`;$("#js-blessMoon").css({"box-shadow":r}),$("#js-blessNum").text(s);for(const e of a)d+=`<p>${e}</p>`;$("#js-blessContent").append(d),anime.timeline({easing:"easeOutElastic(1, .8)",begin:()=>{try{i=new YT.Player("ytplayer",{videoId:o.videoId,playerVars:{start:o.startSeconds}})}catch(e){const t=`<iframe width="${o.width}" height="${o.height}" src="https://www.youtube.com/embed/${o.videoId}?start=${o.startSeconds}" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`;$("#ytplayer").append(t)}},complete:()=>{anime.timeline({complete:()=>{i.playVideo()}}).add({targets:".wrap--day .page-footbox",height:"20.5vh",begin:()=>{$(".page-footbox").addClass("active")}}).add({targets:".wrap--day .ytbox, .wrap--day .ripple",opacity:1})}}).add({targets:"#js-blessMoon",keyframes:[{opacity:1,duration:750,translateY:-10},{translateY:0,duration:250}],delay:1e3}).add({targets:"#js-blessNum",keyframes:[{fontSize:"3em",duration:750},{fontSize:"1em",duration:250}]},1e3).add({targets:".bless__main p",top:0,duration:250,opacity:1,delay:anime.stagger(300),easing:"linear"})})}devMode(){$(".btn--bless").trigger("click")}main(){this.calBbuild(),this.btnBind()}}$(()=>{new DayBless(window).main()}),window.addEventListener("load",e=>{$("#js-loader").fadeOut("slow"),$("#wrap").css("visibility","visible")});